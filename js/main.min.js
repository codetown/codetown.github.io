const form=document.getElementById("search-form");function search(e){const t=e.target.elements.keyword;return t?t.value.trim()?!0:(e.preventDefault(),e.stopPropagation(),!1):(console.error("\u8868\u5355\u4E2D\u672A\u627E\u5230 keyword \u5143\u7D20"),!1)}form.addEventListener("submit",search),document.addEventListener("error",e=>{if(e.target.tagName.toLowerCase()==="img"){if(e.target.getAttribute("data-error-handled")==="true"){e.stopImmediatePropagation();return}e.target.setAttribute("data-error-handled","true"),e.target.onerror=null,e.target.src="images/nopic.png",e.preventDefault(),e.stopPropagation()}},!0);const playerOptions={controls:["play-large","play","progress","current-time","mute","volume","settings","fullscreen"],settings:["quality","speed"],i18n:{restart:"\u91CD\u65B0\u64AD\u653E",rewind:"\u5012\u9000 {seektime} \u79D2",play:"\u64AD\u653E",pause:"\u6682\u505C",fastForward:"\u5FEB\u8FDB {seektime} \u79D2",seek:"Seek",volume:"\u97F3\u91CF",mute:"\u9759\u97F3",unmute:"\u53D6\u6D88\u9759\u97F3",enableCaptions:"\u542F\u7528\u5B57\u5E55",disableCaptions:"\u7981\u7528\u5B57\u5E55",enterFullscreen:"\u8FDB\u5165\u5168\u5C4F",exitFullscreen:"\u9000\u51FA\u5168\u5C4F",settings:"\u8BBE\u7F6E",speed:"\u64AD\u653E\u901F\u5EA6",normal:"\u6B63\u5E38",quality:"\u5F53\u524D\u753B\u8D28",loop:"\u5FAA\u73AF\u64AD\u653E",start:"\u5F00\u59CB",end:"\u7ED3\u675F",all:"\u5168\u90E8",reset:"\u91CD\u7F6E",disabled:"\u5DF2\u7981\u7528"}},state={gHls:null,gPlayer:null,currentCloudIndex:0,currentSerieIndex:0,tabs:Array.from(document.getElementById("cloud-tabs")?.children||[]),clouds:Array.from(document.getElementById("tab-contents")?.children||[]),xlx:document.getElementById("xlx"),jjx:document.getElementById("jjx"),video:document.getElementById("player"),videoTitle:document.getElementById("video-title")?.innerText?.trim()||"\u89C6\u9891\u9ED8\u8BA4\u540D\u79F0"},isM3u8Url=e=>{const t=new URL(e).pathname.toLowerCase();return t.endsWith(".m3u8")||t.endsWith(".m3u")};function setSerie(e,t){if(e<0||e>=state.clouds.length||t<0||t>=state.clouds[e].children.length){console.error("\u65E0\u6548\u7684\u4E91\u6216\u96C6\u7D22\u5F15");return}state.clouds.forEach((l,n)=>{l.style.display=n===e?"flex":"none"});let r="";Array.from(state.clouds[e]?.children||[]).forEach((l,n)=>{l.className=n===t?"active":"normal",n===t&&(r=l.href)}),state.xlx&&(state.xlx.innerHTML=e+1),state.jjx&&(state.jjx.innerHTML=state.clouds[e].children[t]?.innerHTML||""),state.currentCloudIndex=e,state.currentSerieIndex=t,r&&(isM3u8Url(r)?(state.gHls&&state.gHls.destroy(),state.gHls=new Hls,state.gHls.loadSource(r),state.gHls.attachMedia(state.video),state.gHls.on(Hls.Events.MANIFEST_PARSED,()=>{state.gPlayer||(state.gPlayer=new Plyr(state.video,playerOptions))})):(state.gPlayer||(state.gPlayer=new Plyr(state.video,playerOptions)),state.gPlayer.source={type:"video",title:state.videoTitle,sources:[{src:r,type:"video/mp4"}]}))}function setCloud(e){if(e<0||e>=state.tabs.length||e>=state.clouds.length){console.error("\u65E0\u6548\u7684\u4E91\u7D22\u5F15");return}state.tabs.forEach((t,r)=>{t.className=r===e?"active":""}),state.clouds.forEach((t,r)=>{t.style.display=r===e?"flex":"none"}),state.currentCloudIndex=e,setSerie(e,state.currentSerieIndex)}function init(){if(!Hls.isSupported()){alert("\u8BE5\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u89C6\u9891\u6D41\u64AD\u653E\uFF0C\u8BF7\u66F4\u6362\u6D4F\u89C8\u5668\u6253\u5F00\u672C\u7F51\u7AD9");return}state.tabs.length>0&&state.clouds.length>0&&setCloud(0)}state.tabs.length>0&&state.clouds.length>0&&init();
